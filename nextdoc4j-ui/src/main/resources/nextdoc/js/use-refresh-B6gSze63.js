var C=Object.defineProperty,I=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var p=(e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,d=(e,t)=>{for(var s in t||(t={}))x.call(t,s)&&p(e,s,t[s]);if(u)for(var s of u(t))w.call(t,s)&&p(e,s,t[s]);return e},m=(e,t)=>I(e,k(t));var g=(e,t)=>{var s={};for(var a in e)x.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&u)for(var a of u(e))t.indexOf(a)<0&&w.call(e,a)&&(s[a]=e[a]);return s};var o=(e,t,s)=>new Promise((a,i)=>{var n=r=>{try{f(s.next(r))}catch(y){i(y)}},c=r=>{try{f(s.throw(r))}catch(y){i(y)}},f=r=>r.done?a(r.value):Promise.resolve(r.value).then(n,c);f((s=s.apply(e,t)).next())});import{X as K,a as R}from"./bootstrap-D93BAT2S.js";import{aW as _,aX as B,bl as S,a1 as v,r as A}from"../jse/index-index-B4xMpWsb.js";const O=K("core-tabbar",{actions:{_bulkCloseByKeys(e){return o(this,null,function*(){const t=new Set(e);this.tabs=this.tabs.filter(s=>!t.has(h(s))),yield this.updateCacheTabs()})},_close(e){if(b(e))return;const t=this.tabs.findIndex(s=>T(s,e));t!==-1&&this.tabs.splice(t,1)},_goToDefaultTab(e){return o(this,null,function*(){if(this.getTabs.length<=0)return;const t=this.getTabs[0];t&&(yield this._goToTab(t,e))})},_goToTab(e,t){return o(this,null,function*(){const{params:s,path:a,query:i}=e,n={params:s||{},path:a,query:i||{}};yield t.replace(n)})},addTab(e){var a,i;let t=P(e);if(t.key||(t.key=l(e)),!L(t))return t;const s=this.tabs.findIndex(n=>T(n,t));if(s===-1){const n=v.tabbar.maxCount,c=(i=(a=e==null?void 0:e.meta)==null?void 0:a.maxNumOfOpenTab)!=null?i:-1;if(c>0&&this.tabs.filter(f=>f.name===e.name).length>=c){const f=this.tabs.findIndex(r=>r.name===e.name);f!==-1&&this.tabs.splice(f,1)}else if(n>0&&this.tabs.length>=n){const f=this.tabs.findIndex(r=>!Reflect.has(r.meta,"affixTab")||!r.meta.affixTab);f!==-1&&this.tabs.splice(f,1)}this.tabs.push(t)}else{const n=A(this.tabs)[s],c=m(d(d({},n),t),{meta:d(d({},n==null?void 0:n.meta),t.meta)});if(n){const f=n.meta;Reflect.has(f,"affixTab")&&(c.meta.affixTab=f.affixTab),Reflect.has(f,"newTabTitle")&&(c.meta.newTabTitle=f.newTabTitle)}t=c,this.tabs.splice(s,1,c)}return this.updateCacheTabs(),t},closeAllTabs(e){return o(this,null,function*(){const t=this.tabs.filter(s=>b(s));this.tabs=t.length>0?t:[...this.tabs].splice(0,1),yield this._goToDefaultTab(e),this.updateCacheTabs()})},closeLeftTabs(e){return o(this,null,function*(){const t=this.tabs.findIndex(i=>T(i,e));if(t<1)return;const s=this.tabs.slice(0,t),a=[];for(const i of s)b(i)||a.push(i.key);yield this._bulkCloseByKeys(a)})},closeOtherTabs(e){return o(this,null,function*(){const t=this.tabs.map(a=>h(a)),s=[];for(const a of t)if(a!==h(e)){const i=this.tabs.find(n=>h(n)===a);if(!i)continue;b(i)||s.push(i.key)}yield this._bulkCloseByKeys(s)})},closeRightTabs(e){return o(this,null,function*(){const t=this.tabs.findIndex(s=>T(s,e));if(t!==-1&&t<this.tabs.length-1){const s=this.tabs.slice(t+1),a=[];for(const i of s)b(i)||a.push(i.key);yield this._bulkCloseByKeys(a)}})},closeTab(e,t){return o(this,null,function*(){const{currentRoute:s}=t;if(l(s.value)!==h(e)){this._close(e),this.updateCacheTabs();return}const a=this.getTabs.findIndex(c=>h(c)===l(s.value)),i=this.getTabs[a-1],n=this.getTabs[a+1];n?(this._close(e),yield this._goToTab(n,t)):i?(this._close(e),yield this._goToTab(i,t)):console.error("Failed to close the tab; only one tab remains open.")})},closeTabByKey(e,t){return o(this,null,function*(){const s=decodeURIComponent(e),a=this.tabs.findIndex(n=>h(n)===s);if(a===-1)return;const i=this.tabs[a];i&&(yield this.closeTab(i,t))})},getTabByKey(e){return this.getTabs.find(t=>h(t)===e)},openTabInNewWindow(e){return o(this,null,function*(){S(e.fullPath||e.path)})},pinTab(e){return o(this,null,function*(){var n;const t=this.tabs.findIndex(c=>T(c,e));if(t===-1)return;const s=this.tabs[t];e.meta.affixTab=!0,e.meta.title=(n=s==null?void 0:s.meta)==null?void 0:n.title,this.tabs.splice(t,1,e);const i=this.tabs.filter(c=>b(c)).findIndex(c=>T(c,e));yield this.sortTabs(t,i)})},refresh(e){return o(this,null,function*(){if(typeof e=="string")return yield this.refreshByName(e);const{currentRoute:t}=e,{name:s}=t.value;this.excludeCachedTabs.add(s),this.renderRouteView=!1,_(),yield new Promise(a=>setTimeout(a,200)),this.excludeCachedTabs.delete(s),this.renderRouteView=!0,B()})},refreshByName(e){return o(this,null,function*(){this.excludeCachedTabs.add(e),yield new Promise(t=>setTimeout(t,200)),this.excludeCachedTabs.delete(e)})},resetTabTitle(e){return o(this,null,function*(){var s;if((s=e==null?void 0:e.meta)!=null&&s.newTabTitle)return;const t=this.tabs.find(a=>T(a,e));t&&(t.meta.newTabTitle=void 0,yield this.updateCacheTabs())})},setAffixTabs(e){for(const t of e)t.meta.affixTab=!0,this.addTab(N(t))},setMenuList(e){this.menuList=e},setTabTitle(e,t){return o(this,null,function*(){const s=this.tabs.find(a=>T(a,e));s&&(s.meta.newTabTitle=t,yield this.updateCacheTabs())})},setUpdateTime(){this.updateTime=Date.now()},sortTabs(e,t){return o(this,null,function*(){const s=this.tabs[e];s&&(this.tabs.splice(e,1),this.tabs.splice(t,0,s),this.dragEndIndex=this.dragEndIndex+1)})},toggleTabPin(e){return o(this,null,function*(){var s,a;yield((a=(s=e==null?void 0:e.meta)==null?void 0:s.affixTab)!=null?a:!1)?this.unpinTab(e):this.pinTab(e)})},unpinTab(e){return o(this,null,function*(){var n;const t=this.tabs.findIndex(c=>T(c,e));if(t===-1)return;const s=this.tabs[t];e.meta.affixTab=!1,e.meta.title=(n=s==null?void 0:s.meta)==null?void 0:n.title,this.tabs.splice(t,1,e);const i=this.tabs.filter(c=>b(c)).length;yield this.sortTabs(t,i)})},updateCacheTabs(){return o(this,null,function*(){var t;const e=new Set;for(const s of this.tabs){if(!((t=s.meta)==null?void 0:t.keepAlive))continue;(s.matched||[]).forEach((n,c)=>{c>0&&e.add(n.name)});const i=s.name;e.add(i)}this.cachedTabs=e})}},getters:{affixTabs(){return this.tabs.filter(t=>b(t)).sort((t,s)=>{var n,c,f,r;const a=(c=(n=t.meta)==null?void 0:n.affixTabOrder)!=null?c:0,i=(r=(f=s.meta)==null?void 0:f.affixTabOrder)!=null?r:0;return a-i})},getCachedTabs(){return[...this.cachedTabs]},getExcludeCachedTabs(){return[...this.excludeCachedTabs]},getMenuList(){return this.menuList},getTabs(){const e=this.tabs.filter(t=>!b(t));return[...this.affixTabs,...e].filter(Boolean)}},persist:[{pick:["tabs"],storage:sessionStorage}],state:()=>({cachedTabs:new Set,dragEndIndex:0,excludeCachedTabs:new Set,menuList:["close","affix","maximize","reload","open-in-new-window","close-left","close-right","close-other","close-all"],renderRouteView:!0,tabs:[],updateTime:Date.now()})});function P(e){if(!e)return e;const i=e,{matched:t,meta:s}=i,a=g(i,["matched","meta"]);return m(d({},a),{matched:t?t.map(n=>({meta:n.meta,name:n.name,path:n.path})):void 0,meta:m(d({},s),{newTabTitle:s.newTabTitle})})}function b(e){var t,s;return(s=(t=e==null?void 0:e.meta)==null?void 0:t.affixTab)!=null?s:!1}function L(e){var s;const t=(s=e==null?void 0:e.matched)!=null?s:[];return!e.meta.hideInTab&&t.every(a=>!a.meta.hideInTab)}function l(e){const{fullPath:t,path:s,meta:{fullPathKey:a}={},query:i={}}=e,n=Array.isArray(i.pageKey)?i.pageKey[0]:i.pageKey;let c;n?c=n:c=a===!1?s:t!=null?t:s;try{return decodeURIComponent(c)}catch(f){return c}}function h(e){var t;return(t=e.key)!=null?t:l(e)}function T(e,t){return h(e)===h(t)}function N(e){return{meta:e.meta,name:e.name,path:e.path,key:l(e)}}function M(){const e=R(),t=O();function s(){return o(this,null,function*(){yield t.refresh(e)})}return{refresh:s}}export{O as a,l as g,M as u};
