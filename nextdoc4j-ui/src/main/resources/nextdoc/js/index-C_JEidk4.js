var ot=Object.defineProperty,st=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Ie=(e,t,n)=>t in e?ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>{for(var n in t||(t={}))Le.call(t,n)&&Ie(e,n,t[n]);if(re)for(var n of re(t))Be.call(t,n)&&Ie(e,n,t[n]);return e},$=(e,t)=>st(e,dt(t));var Me=(e,t)=>{var n={};for(var d in e)Le.call(e,d)&&t.indexOf(d)<0&&(n[d]=e[d]);if(e!=null&&re)for(var d of re(e))t.indexOf(d)<0&&Be.call(e,d)&&(n[d]=e[d]);return n};var $e=(e,t,n)=>new Promise((d,o)=>{var s=a=>{try{c(n.next(a))}catch(y){o(y)}},r=a=>{try{c(n.throw(a))}catch(y){o(y)}},c=a=>a.done?d(a.value):Promise.resolve(a.value).then(s,r);c((n=n.apply(e,t)).next())});import{s as je,E as ge,a as Pe}from"./index-Bk2AM-cJ.js";import{o as at,G as rt,k as ae,l as H,v as q,w as De,K as it,Z as ze,as as ye,at as lt,Y as Ne,C as P,N as ct,E as ht,au as ut,F as ft,a6 as z,L as yt,t as pt,ag as gt,r as Nt,a as vt}from"./bootstrap-Bwv7EoT6.js";import{e as _,r as w,c as L,n as xe,R as qe,q as j,o as A,s as le,v as we,P as Re,O as I,u as Ct,B as Ve,a2 as kt,h as ve,i as J,Q as ce,a as se,U as He,a5 as mt,W as B,m as V,f as oe,a7 as de,X as F,S as Ce,j as G,l as ke,E as pe,A as ee,F as Ue,Y as Ye,w as S,g as Se,D as bt,ad as We}from"../jse/index-index-Cr1u2jcp.js";import{E as Kt}from"./index-DfETfEnC.js";import{ElCheckbox as Et}from"./index-CdWbNsxy.js";import{u as Dt,a as xt}from"./use-form-common-props-CCSLhXk1.js";import{p as fe,U as te}from"./index-BIIh2HTk.js";import{e as wt}from"./index-huolBIOK.js";import{a as St}from"./isEqual-29hxSYt8.js";import"./index-BuaxDZ9K.js";import"./aria-DGfENwCE.js";import"./use-form-item-BDbynDq4.js";import"./index-DTCIFMXo.js";import"./util-B2mB0_6C.js";import"./error-CYJGVSdm.js";import"./index-CX_WzwPM.js";import"./scroll-PzWhmw9l.js";import"./index-CLNXs_rc.js";import"./index-Dxp_Ithl.js";import"./vnode-BT5dk8Gb.js";import"./index-DriUaG3M.js";import"./_baseFindIndex-D7XfJLKM.js";const Ot=at({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:rt,default:""},truncated:Boolean,lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),Tt=_({name:"ElText"}),At=_($(x({},Tt),{props:Ot,setup(e){const t=e,n=w(),d=Dt(),o=H("text"),s=L(()=>[o.b(),o.m(t.type),o.m(d.value),o.is("truncated",t.truncated),o.is("line-clamp",!q(t.lineClamp))]),r=()=>{var c,a,y,l,g,i,h;if(kt().title)return;let p=!1;const v=((c=n.value)==null?void 0:c.textContent)||"";if(t.truncated){const b=(a=n.value)==null?void 0:a.offsetWidth,K=(y=n.value)==null?void 0:y.scrollWidth;b&&K&&K>b&&(p=!0)}else if(!q(t.lineClamp)){const b=(l=n.value)==null?void 0:l.offsetHeight,K=(g=n.value)==null?void 0:g.scrollHeight;b&&K&&K>b&&(p=!0)}p?(i=n.value)==null||i.setAttribute("title",v):(h=n.value)==null||h.removeAttribute("title")};return xe(r),qe(r),(c,a)=>(A(),j(Ve(c.tag),{ref_key:"textRef",ref:n,class:I(Ct(s)),style:Re({"-webkit-line-clamp":c.lineClamp})},{default:le(()=>[we(c.$slots,"default")]),_:3},8,["class","style"]))}}));var It=ae(At,[["__file","text.vue"]]);const Lt=De(It),Q="$treeNodeId",_e=function(e,t){!t||t[Q]||Object.defineProperty(t,Q,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},Oe=(e,t)=>t==null?void 0:t[e||Q],me=(e,t,n)=>{const d=e.value.currentNode;n();const o=e.value.currentNode;d!==o&&t("current-change",o?o.data:null,o)},be=e=>{let t=!0,n=!0,d=!0;for(let o=0,s=e.length;o<s;o++){const r=e[o];(r.checked!==!0||r.indeterminate)&&(t=!1,r.disabled||(d=!1)),(r.checked!==!1||r.indeterminate)&&(n=!1)}return{all:t,none:n,allWithoutDisable:d,half:!t&&!n}},ne=function(e){if(e.childNodes.length===0||e.loading)return;const{all:t,none:n,half:d}=be(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):d?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const o=e.parent;!o||o.level===0||e.store.checkStrictly||ne(o)},ie=function(e,t){const n=e.store.props,d=e.data||{},o=n[t];if(se(o))return o(d,e);if(He(o))return d[o];if(q(o)){const s=d[t];return q(s)?"":s}};let Bt=0;class R{constructor(t){this.id=Bt++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in t)ve(t,n)&&(this[n]=t[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const t=this.store;if(!t)throw new Error("[Node]store is required!");t.registerNode(this);const n=t.props;if(n&&typeof n.isLeaf!="undefined"){const s=ie(this,"isLeaf");it(s)&&(this.isLeafByUser=s)}if(t.lazy!==!0&&this.data?(this.setData(this.data),t.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&t.lazy&&t.defaultExpandAll&&!this.isLeafByUser&&this.expand(),J(this.data)||_e(this,this.data),!this.data)return;const d=t.defaultExpandedKeys,o=t.key;o&&d&&d.includes(this.key)&&this.expand(null,t.autoExpandParent),o&&t.currentNodeKey!==void 0&&this.key===t.currentNodeKey&&(t.currentNode=this,t.currentNode.isCurrent=!0),t.lazy&&t._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(t){J(t)||_e(this,t),this.data=t,this.childNodes=[];let n;this.level===0&&J(this.data)?n=this.data:n=ie(this,"children")||[];for(let d=0,o=n.length;d<o;d++)this.insertChild({data:n[d]})}get label(){return ie(this,"label")}get key(){const t=this.store.key;return this.data?this.data[t]:null}get disabled(){return ie(this,"disabled")}get nextSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return t.childNodes[n+1]}return null}get previousSibling(){const t=this.parent;if(t){const n=t.childNodes.indexOf(this);if(n>-1)return n>0?t.childNodes[n-1]:null}return null}contains(t,n=!0){return(this.childNodes||[]).some(d=>d===t||n&&d.contains(t))}remove(){const t=this.parent;t&&t.removeChild(this)}insertChild(t,n,d){if(!t)throw new Error("InsertChild error: child is required.");if(!(t instanceof R)){if(!d){const o=this.getChildren(!0);o.includes(t.data)||(q(n)||n<0?o.push(t.data):o.splice(n,0,t.data))}Object.assign(t,{parent:this,store:this.store}),t=ce(new R(t)),t instanceof R&&t.initialize()}t.level=this.level+1,q(n)||n<0?this.childNodes.push(t):this.childNodes.splice(n,0,t),this.updateLeafState()}insertBefore(t,n){let d;n&&(d=this.childNodes.indexOf(n)),this.insertChild(t,d)}insertAfter(t,n){let d;n&&(d=this.childNodes.indexOf(n),d!==-1&&(d+=1)),this.insertChild(t,d)}removeChild(t){const n=this.getChildren()||[],d=n.indexOf(t.data);d>-1&&n.splice(d,1);const o=this.childNodes.indexOf(t);o>-1&&(this.store&&this.store.deregisterNode(t),t.parent=null,this.childNodes.splice(o,1)),this.updateLeafState()}removeChildByData(t){let n=null;for(let d=0;d<this.childNodes.length;d++)if(this.childNodes[d].data===t){n=this.childNodes[d];break}n&&this.removeChild(n)}expand(t,n){const d=()=>{if(n){let o=this.parent;for(;o.level>0;)o.expanded=!0,o=o.parent}this.expanded=!0,t&&t(),this.childNodes.forEach(o=>{o.canFocus=!0})};this.shouldLoadData()?this.loadData(o=>{J(o)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||ne(this),d())}):d()}doCreateChildren(t,n={}){t.forEach(d=>{this.insertChild(Object.assign({data:d},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(t=>{t.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser!="undefined"){this.isLeaf=this.isLeafByUser;return}const t=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!t||t.length===0;return}this.isLeaf=!1}setChecked(t,n,d,o){if(this.indeterminate=t==="half",this.checked=t===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:r,allWithoutDisable:c}=be(this.childNodes);!this.isLeaf&&!r&&c&&(this.checked=!1,t=!1);const a=()=>{if(n){const y=this.childNodes;for(let i=0,h=y.length;i<h;i++){const f=y[i];o=o||t!==!1;const p=f.disabled?f.checked:o;f.setChecked(p,n,!0,o)}const{half:l,all:g}=be(y);g||(this.checked=g,this.indeterminate=l)}};if(this.shouldLoadData()){this.loadData(()=>{a(),ne(this)},{checked:t!==!1});return}else a()}const s=this.parent;!s||s.level===0||d||ne(s)}getChildren(t=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const d=this.store.props;let o="children";return d&&(o=d.children||"children"),q(n[o])&&(n[o]=null),t&&!n[o]&&(n[o]=[]),n[o]}updateChildren(){const t=this.getChildren()||[],n=this.childNodes.map(s=>s.data),d={},o=[];t.forEach((s,r)=>{const c=s[Q];!!c&&n.findIndex(y=>y[Q]===c)>=0?d[c]={index:r,data:s}:o.push({index:r,data:s})}),this.store.lazy||n.forEach(s=>{d[s[Q]]||this.removeChildByData(s)}),o.forEach(({index:s,data:r})=>{this.insertChild({data:r},s)}),this.updateLeafState()}loadData(t,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const d=s=>{this.childNodes=[],this.doCreateChildren(s,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),t&&t.call(this,s)},o=()=>{this.loading=!1};this.store.load(this,d,o)}else t&&t.call(this)}eachNode(t){const n=[this];for(;n.length;){const d=n.shift();n.unshift(...d.childNodes),t(d)}}reInitChecked(){this.store.checkStrictly||ne(this)}}class Mt{constructor(t){this.currentNode=null,this.currentNodeKey=null;for(const n in t)ve(t,n)&&(this[n]=t[n]);this.nodesMap={}}initialize(){if(this.root=new R({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const t=this.load;t(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(t){const n=this.filterNodeMethod,d=this.lazy,o=function(s){return $e(this,null,function*(){const r=s.root?s.root.childNodes:s.childNodes;for(const[c,a]of r.entries())a.visible=n.call(a,t,a.data,a),c%80===0&&c>0&&(yield B()),yield o(a);if(!s.visible&&r.length){let c=!0;c=!r.some(a=>a.visible),s.root?s.root.visible=c===!1:s.visible=c===!1}t&&s.visible&&!s.isLeaf&&(!d||s.loaded)&&s.expand()})};o(this)}setData(t){t!==this.root.data?(this.nodesMap={},this.root.setData(t),this._initDefaultCheckedNodes(),this.setCurrentNodeKey(this.currentNodeKey)):this.root.updateChildren()}getNode(t){if(t instanceof R)return t;const n=mt(t)?Oe(this.key,t):t;return this.nodesMap[n]||null}insertBefore(t,n){const d=this.getNode(n);d.parent.insertBefore({data:t},d)}insertAfter(t,n){const d=this.getNode(n);d.parent.insertAfter({data:t},d)}remove(t){const n=this.getNode(t);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(t,n){const d=ze(n)?this.root:this.getNode(n);d&&d.insertChild({data:t})}_initDefaultCheckedNodes(){const t=this.defaultCheckedKeys||[],n=this.nodesMap;t.forEach(d=>{const o=n[d];o&&o.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(t){(this.defaultCheckedKeys||[]).includes(t.key)&&t.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(t){t!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=t,this._initDefaultCheckedNodes())}registerNode(t){const n=this.key;!t||!t.data||(n?t.key!==void 0&&(this.nodesMap[t.key]=t):this.nodesMap[t.id]=t)}deregisterNode(t){!this.key||!t||!t.data||(t.childNodes.forEach(d=>{this.deregisterNode(d)}),delete this.nodesMap[t.key])}getCheckedNodes(t=!1,n=!1){const d=[],o=function(s){(s.root?s.root.childNodes:s.childNodes).forEach(c=>{(c.checked||n&&c.indeterminate)&&(!t||t&&c.isLeaf)&&d.push(c.data),o(c)})};return o(this),d}getCheckedKeys(t=!1){return this.getCheckedNodes(t).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const t=[],n=function(d){(d.root?d.root.childNodes:d.childNodes).forEach(s=>{s.indeterminate&&t.push(s.data),n(s)})};return n(this),t}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(t=>(t||{})[this.key])}_getAllNodes(){const t=[],n=this.nodesMap;for(const d in n)ve(n,d)&&t.push(n[d]);return t}updateChildren(t,n){const d=this.nodesMap[t];if(!d)return;const o=d.childNodes;for(let s=o.length-1;s>=0;s--){const r=o[s];this.remove(r.data)}for(let s=0,r=n.length;s<r;s++){const c=n[s];this.append(c,d.data)}}_setCheckedKeys(t,n=!1,d){const o=this._getAllNodes().sort((a,y)=>a.level-y.level),s=Object.create(null),r=Object.keys(d);o.forEach(a=>a.setChecked(!1,!1));const c=a=>{a.childNodes.forEach(y=>{var l;s[y.data[t]]=!0,(l=y.childNodes)!=null&&l.length&&c(y)})};for(let a=0,y=o.length;a<y;a++){const l=o[a],g=l.data[t].toString();if(!r.includes(g)){l.checked&&!s[g]&&l.setChecked(!1,!1);continue}if(l.childNodes.length&&c(l),l.isLeaf||this.checkStrictly){l.setChecked(!0,!1);continue}if(l.setChecked(!0,!0),n){l.setChecked(!1,!1);const h=function(f){f.childNodes.forEach(v=>{v.isLeaf||v.setChecked(!1,!1),h(v)})};h(l)}}}setCheckedNodes(t,n=!1){const d=this.key,o={};t.forEach(s=>{o[(s||{})[d]]=!0}),this._setCheckedKeys(d,n,o)}setCheckedKeys(t,n=!1){this.defaultCheckedKeys=t;const d=this.key,o={};t.forEach(s=>{o[s]=!0}),this._setCheckedKeys(d,n,o)}setDefaultExpandedKeys(t){t=t||[],this.defaultExpandedKeys=t,t.forEach(n=>{const d=this.getNode(n);d&&d.expand(null,this.autoExpandParent)})}setChecked(t,n,d){const o=this.getNode(t);o&&o.setChecked(!!n,d)}getCurrentNode(){return this.currentNode}setCurrentNode(t){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=t,this.currentNode.isCurrent=!0}setUserCurrentNode(t,n=!0){const d=t[this.key],o=this.nodesMap[d];this.setCurrentNode(o),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(t,n=!0){if(this.currentNodeKey=t,ze(t)){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const d=this.getNode(t);d&&(this.setCurrentNode(d),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const Te="RootTree",Je="NodeInstance",Fe="TreeNodeMap",$t=_({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const t=H("tree"),n=V(Je),d=V(Te);return()=>{const o=e.node,{data:s,store:r}=o;return e.renderContent?e.renderContent(oe,{_self:n,node:o,data:s,store:r}):we(d.ctx.slots,"default",{node:o,data:s},()=>[oe(Lt,{tag:"span",truncated:!0,class:t.be("node","label")},()=>[o.label])])}}});var Pt=ae($t,[["__file","tree-node-content.vue"]]);function Ge(e){const t=V(Fe,null),n={treeNodeExpand:d=>{e.node!==d&&e.node.collapse()},children:[]};return t&&t.children.push(n),de(Fe,n),{broadcastExpanded:d=>{if(e.accordion)for(const o of n.children)o.treeNodeExpand(d)}}}const Qe=Symbol("dragEvents");function zt({props:e,ctx:t,el$:n,dropIndicator$:d,store:o}){const s=H("tree"),r=w({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return de(Qe,{treeNodeDragStart:({event:l,treeNode:g})=>{if(se(e.allowDrag)&&!e.allowDrag(g.node))return l.preventDefault(),!1;l.dataTransfer.effectAllowed="move";try{l.dataTransfer.setData("text/plain","")}catch(i){}r.value.draggingNode=g,t.emit("node-drag-start",g.node,l)},treeNodeDragOver:({event:l,treeNode:g})=>{const i=g,h=r.value.dropNode;h&&h.node.id!==i.node.id&&ye(h.$el,s.is("drop-inner"));const f=r.value.draggingNode;if(!f||!i)return;let p=!0,v=!0,b=!0,K=!0;se(e.allowDrop)&&(p=e.allowDrop(f.node,i.node,"prev"),K=v=e.allowDrop(f.node,i.node,"inner"),b=e.allowDrop(f.node,i.node,"next")),l.dataTransfer.dropEffect=v||p||b?"move":"none",(p||v||b)&&(h==null?void 0:h.node.id)!==i.node.id&&(h&&t.emit("node-drag-leave",f.node,h.node,l),t.emit("node-drag-enter",f.node,i.node,l)),p||v||b?r.value.dropNode=i:r.value.dropNode=null,i.node.nextSibling===f.node&&(b=!1),i.node.previousSibling===f.node&&(p=!1),i.node.contains(f.node,!1)&&(v=!1),(f.node===i.node||f.node.contains(i.node))&&(p=!1,v=!1,b=!1);const D=i.$el.querySelector(`.${s.be("node","content")}`).getBoundingClientRect(),k=n.value.getBoundingClientRect();let E;const U=p?v?.25:b?.45:1:-1,O=b?v?.75:p?.55:0:1;let Y=-9999;const N=l.clientY-D.top;N<D.height*U?E="before":N>D.height*O?E="after":v?E="inner":E="none";const C=i.$el.querySelector(`.${s.be("node","expand-icon")}`).getBoundingClientRect(),T=d.value;E==="before"?Y=C.top-k.top:E==="after"&&(Y=C.bottom-k.top),T.style.top=`${Y}px`,T.style.left=`${C.right-k.left}px`,E==="inner"?lt(i.$el,s.is("drop-inner")):ye(i.$el,s.is("drop-inner")),r.value.showDropIndicator=E==="before"||E==="after",r.value.allowDrop=r.value.showDropIndicator||K,r.value.dropType=E,t.emit("node-drag-over",f.node,i.node,l)},treeNodeDragEnd:l=>{const{draggingNode:g,dropType:i,dropNode:h}=r.value;if(l.preventDefault(),l.dataTransfer&&(l.dataTransfer.dropEffect="move"),g&&h){const f={data:g.node.data};i!=="none"&&g.node.remove(),i==="before"?h.node.parent.insertBefore(f,h.node):i==="after"?h.node.parent.insertAfter(f,h.node):i==="inner"&&h.node.insertChild(f),i!=="none"&&(o.value.registerNode(f),o.value.key&&g.node.eachNode(p=>{var v;(v=o.value.nodesMap[p.data[o.value.key]])==null||v.setChecked(p.checked,!o.value.checkStrictly)})),ye(h.$el,s.is("drop-inner")),t.emit("node-drag-end",g.node,h.node,i,l),i!=="none"&&t.emit("node-drop",g.node,h.node,i,l)}g&&!h&&t.emit("node-drag-end",g.node,null,i,l),r.value.showDropIndicator=!1,r.value.draggingNode=null,r.value.dropNode=null,r.value.allowDrop=!0}}),{dragState:r}}const _t=_({name:"ElTreeNode",components:{ElCollapseTransition:Kt,ElCheckbox:Et,NodeContent:Pt,ElIcon:ht,Loading:ct},props:{node:{type:R,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,t){const n=H("tree"),{broadcastExpanded:d}=Ge(e),o=V(Te),s=w(!1),r=w(!1),c=w(),a=w(),y=w(),l=V(Qe),g=Se();de(Je,g),e.node.expanded&&(s.value=!0,r.value=!0);const i=o.props.props.children||"children";S(()=>{var N;const C=(N=e.node.data)==null?void 0:N[i];return C&&[...C]},()=>{e.node.updateChildren()}),S(()=>e.node.indeterminate,N=>{p(e.node.checked,N)}),S(()=>e.node.checked,N=>{p(N,e.node.indeterminate)}),S(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),S(()=>e.node.expanded,N=>{B(()=>s.value=N),N&&(r.value=!0)});const h=N=>Oe(o.props.nodeKey,N.data),f=N=>{const C=e.props.class;if(!C)return{};let T;if(se(C)){const{data:X}=N;T=C(X,N)}else T=C;return He(T)?{[T]:!0}:T},p=(N,C)=>{(c.value!==N||a.value!==C)&&o.ctx.emit("check-change",e.node.data,N,C),c.value=N,a.value=C},v=N=>{me(o.store,o.ctx.emit,()=>{var C;if((C=o==null?void 0:o.props)==null?void 0:C.nodeKey){const X=h(e.node);o.store.value.setCurrentNodeKey(X)}else o.store.value.setCurrentNode(e.node)}),o.currentNode.value=e.node,o.props.expandOnClickNode&&K(),(o.props.checkOnClickNode||e.node.isLeaf&&o.props.checkOnClickLeaf&&e.showCheckbox)&&!e.node.disabled&&D(!e.node.checked),o.ctx.emit("node-click",e.node.data,e.node,g,N)},b=N=>{var C;(C=o.instance.vnode.props)!=null&&C.onNodeContextmenu&&(N.stopPropagation(),N.preventDefault()),o.ctx.emit("node-contextmenu",N,e.node.data,e.node,g)},K=()=>{e.node.isLeaf||(s.value?(o.ctx.emit("node-collapse",e.node.data,e.node,g),e.node.collapse()):e.node.expand(()=>{t.emit("node-expand",e.node.data,e.node,g)}))},D=N=>{e.node.setChecked(N,!(o!=null&&o.props.checkStrictly)),B(()=>{const C=o.store.value;o.ctx.emit("check",e.node.data,{checkedNodes:C.getCheckedNodes(),checkedKeys:C.getCheckedKeys(),halfCheckedNodes:C.getHalfCheckedNodes(),halfCheckedKeys:C.getHalfCheckedKeys()})})};return{ns:n,node$:y,tree:o,expanded:s,childNodeRendered:r,oldChecked:c,oldIndeterminate:a,getNodeKey:h,getNodeClass:f,handleSelectChange:p,handleClick:v,handleContextMenu:b,handleExpandIconClick:K,handleCheckChange:D,handleChildNodeExpand:(N,C,T)=>{d(C),o.ctx.emit("node-expand",N,C,T)},handleDragStart:N=>{o.props.draggable&&l.treeNodeDragStart({event:N,treeNode:e})},handleDragOver:N=>{N.preventDefault(),o.props.draggable&&l.treeNodeDragOver({event:N,treeNode:{$el:y.value,node:e.node}})},handleDrop:N=>{N.preventDefault()},handleDragEnd:N=>{o.props.draggable&&l.treeNodeDragEnd(N)},CaretRight:ut}}});function Ft(e,t,n,d,o,s){const r=F("el-icon"),c=F("el-checkbox"),a=F("loading"),y=F("node-content"),l=F("el-tree-node"),g=F("el-collapse-transition");return Ce((A(),G("div",{ref:"node$",class:I([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:P(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:P(e.handleDragStart,["stop"]),onDragover:P(e.handleDragOver,["stop"]),onDragend:P(e.handleDragEnd,["stop"]),onDrop:P(e.handleDrop,["stop"])},[ke("div",{class:I(e.ns.be("node","content")),style:Re({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(A(),j(r,{key:0,class:I([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:P(e.handleExpandIconClick,["stop"])},{default:le(()=>[(A(),j(Ve(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):ee("v-if",!0),e.showCheckbox?(A(),j(c,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:P(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):ee("v-if",!0),e.node.loading?(A(),j(r,{key:2,class:I([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:le(()=>[pe(a)]),_:1},8,["class"])):ee("v-if",!0),pe(y,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),pe(g,null,{default:le(()=>[!e.renderAfterExpand||e.childNodeRendered?Ce((A(),G("div",{key:0,class:I(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded,onClick:P(()=>{},["stop"])},[(A(!0),G(Ue,null,Ye(e.node.childNodes,i=>(A(),j(l,{key:e.getNodeKey(i),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:i,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded","onClick"])),[[Ne,e.expanded]]):ee("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[Ne,e.node.visible]])}var jt=ae(_t,[["render",Ft],["__file","tree-node.vue"]]);function qt({el$:e},t){const n=H("tree");xe(()=>{o()}),qe(()=>{Array.from(e.value.querySelectorAll("input[type=checkbox]")).forEach(r=>{r.setAttribute("tabindex","-1")})}),ft(e,"keydown",s=>{const r=s.target;if(!r.className.includes(n.b("node")))return;const c=s.code,a=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),y=a.indexOf(r);let l;if([z.up,z.down].includes(c)){if(s.preventDefault(),c===z.up){l=y===-1?0:y!==0?y-1:a.length-1;const i=l;for(;!t.value.getNode(a[l].dataset.key).canFocus;){if(l--,l===i){l=-1;break}l<0&&(l=a.length-1)}}else{l=y===-1?0:y<a.length-1?y+1:0;const i=l;for(;!t.value.getNode(a[l].dataset.key).canFocus;){if(l++,l===i){l=-1;break}l>=a.length&&(l=0)}}l!==-1&&a[l].focus()}[z.left,z.right].includes(c)&&(s.preventDefault(),r.click());const g=r.querySelector('[type="checkbox"]');[z.enter,z.numpadEnter,z.space].includes(c)&&g&&(s.preventDefault(),g.click())});const o=()=>{var s;const r=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));Array.from(e.value.querySelectorAll("input[type=checkbox]")).forEach(y=>{y.setAttribute("tabindex","-1")});const a=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(a.length){a[0].setAttribute("tabindex","0");return}(s=r[0])==null||s.setAttribute("tabindex","0")}}const Rt=_({name:"ElTree",components:{ElTreeNode:jt},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkOnClickLeaf:{type:Boolean,default:!0},checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:yt}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,t){const{t:n}=pt(),d=H("tree"),o=V(je,null),s=w(new Mt({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));s.value.initialize();const r=w(s.value.root),c=w(null),a=w(null),y=w(null),{broadcastExpanded:l}=Ge(e),{dragState:g}=zt({props:e,ctx:t,el$:a,dropIndicator$:y,store:s});qt({el$:a},s);const i=L(()=>{const{childNodes:u}=r.value,m=o?o.hasFilteredOptions!==0:!1;return(!u||u.length===0||u.every(({visible:M})=>!M))&&!m});S(()=>e.currentNodeKey,u=>{s.value.setCurrentNodeKey(u)}),S(()=>e.defaultCheckedKeys,u=>{s.value.setDefaultCheckedKey(u)}),S(()=>e.defaultExpandedKeys,u=>{s.value.setDefaultExpandedKeys(u)}),S(()=>e.data,u=>{s.value.setData(u)},{deep:!0}),S(()=>e.checkStrictly,u=>{s.value.checkStrictly=u});const h=u=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");s.value.filter(u)},f=u=>Oe(e.nodeKey,u.data),p=u=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const m=s.value.getNode(u);if(!m)return[];const M=[m.data];let Z=m.parent;for(;Z&&Z!==r.value;)M.push(Z.data),Z=Z.parent;return M.reverse()},v=(u,m)=>s.value.getCheckedNodes(u,m),b=u=>s.value.getCheckedKeys(u),K=()=>{const u=s.value.getCurrentNode();return u?u.data:null},D=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const u=K();return u?u[e.nodeKey]:null},k=(u,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");s.value.setCheckedNodes(u,m)},E=(u,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");s.value.setCheckedKeys(u,m)},U=(u,m,M)=>{s.value.setChecked(u,m,M)},O=()=>s.value.getHalfCheckedNodes(),Y=()=>s.value.getHalfCheckedKeys(),N=(u,m=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");me(s,t.emit,()=>{l(u),s.value.setUserCurrentNode(u,m)})},C=(u,m=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");me(s,t.emit,()=>{l(),s.value.setCurrentNodeKey(u,m)})},T=u=>s.value.getNode(u),X=u=>{s.value.remove(u)},Xe=(u,m)=>{s.value.append(u,m)},Ze=(u,m)=>{s.value.insertBefore(u,m)},et=(u,m)=>{s.value.insertAfter(u,m)},tt=(u,m,M)=>{l(m),t.emit("node-expand",u,m,M)},nt=(u,m)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");s.value.updateChildren(u,m)};return de(Te,{ctx:t,props:e,store:s,root:r,currentNode:c,instance:Se()}),de(xt,void 0),{ns:d,store:s,root:r,currentNode:c,dragState:g,el$:a,dropIndicator$:y,isEmpty:i,filter:h,getNodeKey:f,getNodePath:p,getCheckedNodes:v,getCheckedKeys:b,getCurrentNode:K,getCurrentKey:D,setCheckedNodes:k,setCheckedKeys:E,setChecked:U,getHalfCheckedNodes:O,getHalfCheckedKeys:Y,setCurrentNode:N,setCurrentKey:C,t:n,getNode:T,remove:X,append:Xe,insertBefore:Ze,insertAfter:et,handleNodeExpand:tt,updateKeyChildren:nt}}});function Vt(e,t,n,d,o,s){const r=F("el-tree-node");return A(),G("div",{ref:"el$",class:I([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(A(!0),G(Ue,null,Ye(e.root.childNodes,c=>(A(),j(r,{key:e.getNodeKey(c),node:c,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(A(),G("div",{key:0,class:I(e.ns.e("empty-block"))},[we(e.$slots,"empty",{},()=>{var c;return[ke("span",{class:I(e.ns.e("empty-text"))},bt((c=e.emptyText)!=null?c:e.t("el.tree.emptyText")),3)]})],2)):ee("v-if",!0),Ce(ke("div",{ref:"dropIndicator$",class:I(e.ns.e("drop-indicator"))},null,2),[[Ne,e.dragState.showDropIndicator]])],2)}var Ht=ae(Rt,[["render",Vt],["__file","tree.vue"]]);const Ke=De(Ht),Ut=(e,{attrs:t,emit:n},{select:d,tree:o,key:s})=>{const r=H("tree-select");return S(()=>e.data,()=>{e.filterable&&B(()=>{var a,y;(y=o.value)==null||y.filter((a=d.value)==null?void 0:a.states.inputValue)})},{flush:"post"}),$(x(x({},fe(We(e),Object.keys(ge.props))),t),{class:L(()=>t.class),style:L(()=>t.style),"onUpdate:modelValue":a=>n(te,a),valueKey:s,popperClass:L(()=>{const a=[r.e("popper")];return e.popperClass&&a.push(e.popperClass),a.join(" ")}),filterMethod:(a="")=>{var y;e.filterMethod?e.filterMethod(a):e.remoteMethod?e.remoteMethod(a):(y=o.value)==null||y.filter(a)}})},Yt=_({extends:Pe,setup(e,t){const n=Pe.setup(e,t);delete n.selectOptionClick;const d=Se().proxy;return B(()=>{n.select.states.cachedOptions.get(d.value)||n.select.onOptionCreate(d)}),S(()=>t.attrs.visible,o=>{B(()=>{n.states.visible=o})},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function Ee(e){return e||e===0}function Ae(e){return J(e)&&e.length}function W(e){return J(e)?e:Ee(e)?[e]:[]}function he(e,t,n,d,o){for(let s=0;s<e.length;s++){const r=e[s];if(t(r,s,e,o))return d?d(r,s,e,o):r;{const c=n(r);if(Ae(c)){const a=he(c,t,n,d,r);if(a)return a}}}}function ue(e,t,n,d){for(let o=0;o<e.length;o++){const s=e[o];t(s,o,e,d);const r=n(s);Ae(r)&&ue(r,t,n,s)}}const Wt=(e,{attrs:t,slots:n,emit:d},{select:o,tree:s,key:r})=>{S([()=>e.modelValue,s],()=>{e.showCheckbox&&B(()=>{const i=s.value;i&&!St(i.getCheckedKeys(),W(e.modelValue))&&i.setCheckedKeys(W(e.modelValue))})},{immediate:!0,deep:!0});const c=L(()=>x({value:r.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf"},e.props)),a=(i,h)=>{var f;const p=c.value[i];return se(p)?p(h,(f=s.value)==null?void 0:f.getNode(a("value",h))):h[p]},y=W(e.modelValue).map(i=>he(e.data||[],h=>a("value",h)===i,h=>a("children",h),(h,f,p,v)=>v&&a("value",v))).filter(i=>Ee(i)),l=L(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const i=[];return ue(e.data.concat(e.cacheData),h=>{const f=a("value",h);i.push({value:f,currentLabel:a("label",h),isDisabled:a("disabled",h)})},h=>a("children",h)),i}),g=()=>{var i;return(i=s.value)==null?void 0:i.getCheckedKeys().filter(h=>{var f;const p=(f=s.value)==null?void 0:f.getNode(h);return!Nt(p)&&gt(p.childNodes)})};return $(x(x({},fe(We(e),Object.keys(Ke.props))),t),{nodeKey:r,expandOnClickNode:L(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:L(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(y):y),renderContent:(i,{node:h,data:f,store:p})=>i(Yt,{value:a("value",f),label:a("label",f),disabled:a("disabled",f),visible:h.visible},e.renderContent?()=>e.renderContent(i,{node:h,data:f,store:p}):n.default?()=>n.default({node:h,data:f,store:p}):void 0),filterNodeMethod:(i,h,f)=>e.filterNodeMethod?e.filterNodeMethod(i,h,f):i?new RegExp(wt(i),"i").test(a("label",h)||""):!0,onNodeClick:(i,h,f)=>{var p,v,b,K;if((p=t.onNodeClick)==null||p.call(t,i,h,f),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||h.isLeaf)){if(!a("disabled",i)){const D=(v=o.value)==null?void 0:v.states.options.get(a("value",i));(b=o.value)==null||b.handleOptionSelect(D)}}else e.expandOnClickNode&&f.proxy.handleExpandIconClick();(K=o.value)==null||K.focus()}},onCheck:(i,h)=>{var f;if(!e.showCheckbox)return;const p=a("value",i),v={};ue([s.value.store.root],k=>v[k.key]=k,k=>k.childNodes);const b=h.checkedKeys,K=e.multiple?W(e.modelValue).filter(k=>!(k in v)&&!b.includes(k)):[],D=K.concat(b);if(e.checkStrictly)d(te,e.multiple?D:D.includes(p)?p:void 0);else if(e.multiple){const k=g();d(te,K.concat(k))}else{const k=he([i],O=>!Ae(a("children",O))&&!a("disabled",O),O=>a("children",O)),E=k?a("value",k):void 0,U=Ee(e.modelValue)&&!!he([i],O=>a("value",O)===e.modelValue,O=>a("children",O));d(te,E===e.modelValue||U?void 0:E)}B(()=>{var k;const E=W(e.modelValue);s.value.setCheckedKeys(E),(k=t.onCheck)==null||k.call(t,i,{checkedKeys:s.value.getCheckedKeys(),checkedNodes:s.value.getCheckedNodes(),halfCheckedKeys:s.value.getHalfCheckedKeys(),halfCheckedNodes:s.value.getHalfCheckedNodes()})}),(f=o.value)==null||f.focus()},onNodeExpand:(i,h,f)=>{var p;(p=t.onNodeExpand)==null||p.call(t,i,h,f),B(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&h.checked){const v={},b=s.value.getCheckedKeys();ue([s.value.store.root],k=>v[k.key]=k,k=>k.childNodes);const K=W(e.modelValue).filter(k=>!(k in v)&&!b.includes(k)),D=g();d(te,K.concat(D))}})},cacheOptions:l})};var Jt=_({props:{data:{type:Array,default:()=>[]}},setup(e){const t=V(je);return S(()=>e.data,()=>{var n;e.data.forEach(o=>{t.states.cachedOptions.has(o.value)||t.states.cachedOptions.set(o.value,o)});const d=((n=t.selectRef)==null?void 0:n.querySelectorAll("input"))||[];vt&&!Array.from(d).includes(document.activeElement)&&t.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Gt=_({name:"ElTreeSelect",inheritAttrs:!1,props:$(x(x({},ge.props),Ke.props),{cacheData:{type:Array,default:()=>[]}}),setup(e,t){const{slots:n,expose:d}=t,o=w(),s=w(),r=L(()=>e.nodeKey||e.valueKey||"value"),c=Ut(e,t,{select:o,tree:s,key:r}),g=Wt(e,t,{select:o,tree:s,key:r}),{cacheOptions:a}=g,y=Me(g,["cacheOptions"]),l=ce({});return d(l),xe(()=>{Object.assign(l,x(x({},fe(s.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"])),fe(o.value,["focus","blur","selectedLabel"])))}),()=>oe(ge,ce($(x({},c),{ref:i=>o.value=i})),$(x({},n),{default:()=>[oe(Jt,{data:a.value}),oe(Ke,ce($(x({},y),{ref:i=>s.value=i})))]}))}});var Qt=ae(Gt,[["__file","tree-select.vue"]]);const bn=De(Qt);export{bn as ElTreeSelect,bn as default};
